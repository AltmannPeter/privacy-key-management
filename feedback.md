# Feedback to enable Hierarchical Deterministic Keys in the Wallet Toolbox

**Version:** 0.1.0-SNAPSHOT

**Authors:** Sander Dijkhuis (Cleverbase, editor)

**License:** [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/)

## Context

For a general introduction, see [Hierarchical Deterministic Keys for the European Digital Identity Wallet](README.md). In the current document, the authors develop and share structured feedback on one part of the Wallet Toolbox: the [Architecture and Reference Framework](https://eu-digital-identity-wallet.github.io/eudi-doc-architecture-and-reference-framework/latest/arf/) (ARF). the purpose of this feedback is to enable implementation of Hierarchical Deterministc Keys.

By enabling Hierarchical Deterministic Keys, we aim for interoperability with a concrete and desirable cryptographic architecture in the context of person identification data and some (qualified) electronic attestations of attributes. We do not suggest to mandate the application of this cryptographic architecture for all digital identity documents. Instead, we aim to address two risks to the ARF and subsequently the implementing acts: the risk of accidentally disabling desirable technical solutions, and the risk of accidentally requiring undesirable technical solutions.

> [!NOTE]
> This information is shared by participants of the [Potential Consortium](https://www.digital-identity-wallet.eu). Views and opinions expressed are those of the authors only and do not necessarily reflect those of all Potential members.

## Feedback on the high level requirements

The original requirement texts are copied from ARF 1.4.0.

### Topic 9 - Wallet Trust Evidence

In HDK, the Wallet Trust Evidence (WTE) public key is generated using HDK-Public-Key on the root node. The Wallet Provider issues WTE based on for example:

- app and/or key attestation of the device key;
- proof of knowledge of the root node’s key blinding private key.

To enable HDK, the following changes to Topic 9 are needed.

|Index|Proposed change|Rationale|
|--|--|--|
|WTE_13 part 1|Reword: “During PID or attestation issuance, a WSCA <del>SHALL generate a new key pair for a new PID or attestation, on request of the PID Provider or Attestation Provider via the Wallet Instance. The PID Provider or Attestation Provider</del> SHALL indicate a single WTE public key (see WTE_10) with which the new PID or attestation key must be associated. This indication <del>can either be direct, by providing the WTE public key value, or</del> SHALL be indirect, by providing a public key value that has been associated with the WTE key previously. <del>In the latter case, the WSCA SHALL look up the associated WTE key in its internal registry.</del>”|In HDK, the WSCA indicates an ARKG public key to associate with, and not the Provider. The Provider derives the new key pair for the new PID or attestation.|
|WTE_14|“During PID or attestation issuance, a WSCA SHALL prove possession of the private key corresponding to the <ins>parent key of the new</ins> PID or attestation public key, on request of the PID Provider or Attestation Provider via the Wallet Instance, for example by signing a challenge with that private key.”|In HDK, the PID or attestation public keys are generated by the Provider to enable issuing many single-use copies with different public keys.|

### Topic 18 - Relying Party handling EUDI Wallet attribute combined presentation

With HDK, document readers do not need the proof of association, as they may instead rely on attributes attested by issuers. Since the issuers apply HDK, they can for example ensure binding to PID.

To enable HDK, the following changes to Topic 18 are needed.

|Index|Proposed change|Rationale|
|--|--|--|
|ACP_04|Remove or reword: “If (as a result of ACP_03) a Wallet Instance determines it must release multiple attestations to a Relying Party in a combined presentation of attributes, it <del>SHALL</del><ins>MAY</ins> request a proof of association between the public keys of these attestations from the WSC<ins>A</ins>.”|Proof of association could created unintended non-repudiable proof of revealing a certain combination of attestations. See [Proof of association](keys.md#proofs-of-association).|
